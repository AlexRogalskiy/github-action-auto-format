name: "auto-format-reusable"
on:
  workflow_call:
    inputs:
      actions-files-checkout-path:
        description: 'The path on the github-runner to checkout the auto-format action scripts to at runtime'
        type: string
        default: github-action-auto-format
        required: false
      format-task:
        description: "Name of formatting task to execute. (Options include: readme, github, and terraform.)"
        type: string
        required: true
      bot-name:
        description: "Username that will be used for writing new commits"
        type: string
        required: false
        default: cloudpossebot
    secrets:
      workflow-token:
        description: "Token with `workflows` permission, for use in `github_format.sh` and PR creation steps"
        required: true

jobs:
  auto-format:
    # only run on pull requests so long as they don't come from forks
    if: ${{ !( (github.event_name == 'pull_request') && (github.event.pull_request.head.repo.full_name != github.repository) ) }}
    runs-on: ubuntu-latest

    # Delete "format-task:" lines as desired to limit the scope of the overall auto-formatting task.
    #strategy:
    #  matrix:
    #    include:
    #      - format-task: "readme"
    #      - format-task: "github"
    #      - format-task: "terraform"

    steps:
    - uses: cloudposse/github-action-auto-format@review-branch
      with:
        format-task: ${{ inputs.format-task }}
        workflow-token: ${{ secrets.workflow_token }}
        #workflow-token: ${{ secrets.TOKEN_WITH_WORKFLOWS_PERMISSION }}
        bot-name: ${{ inputs.bot-name }}
